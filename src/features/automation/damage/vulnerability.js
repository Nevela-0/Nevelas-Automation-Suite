export function hasMatchingVulnerability(damageVulnerabilities, instances) {
    if (!damageVulnerabilities) return false;
    const standard = damageVulnerabilities.standard;
    const customRaw = damageVulnerabilities.custom ?? [];
    const customList = Array.isArray(customRaw) ? customRaw : Array.from(customRaw);
    const custom = customList.map((v) => String(v).toLowerCase());
    if (!standard?.size && custom.length === 0) return false;

    for (const inst of instances) {
        const types = Array.from(inst?.typeIds ?? inst?.types ?? []);
        for (const t of types) {
            if (standard?.has?.(t)) return true;
            if (custom.includes(String(t).toLowerCase())) return true;
        }
    }
    return false;
}

export function damageVulnerabilityCalculation(damageVulnerabilities, attackDamage, damageSortObjects) {
    const dvCustom = damageVulnerabilities.custom.map(name => name.toLowerCase());

    damageSortObjects.forEach(object => {
        object.names.forEach(type=>{
            if (damageVulnerabilities.standard.has(type) || dvCustom.has(type)) {
                object.amount *= 1.5;
                object.amount = Math.floor(object.amount);
                if (attackDamage[object.index].total) { 
                    attackDamage[object.index].total = object.amount
                } else { 
                    attackDamage[object.index].number = object.amount
                };
            };
        });
    
    });
};
